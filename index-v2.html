<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alexandra's Schedule - Rules Engine v2.0</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --text-main: #1a1a1a;

            /* Mother */
            --my-bg: #ffffff;
            --my-accent: #00897b;

            /* Father/Away */
            --away-bg: #e0e0e0;
            --away-text: #757575;

            /* Actions */
            --act-pick: #00897b;
            --act-drop: #455a64;
            --act-receive: #689f38;

            /* TBD/Warning */
            --warning-bg: #fff3e0;
            --warning-text: #ef6c00;

            /* Debug */
            --debug-bg: #e8f5e9;
            --debug-text: #2e7d32;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 40px 10px;
            color: var(--text-main);
        }

        .container { max-width: 950px; margin: 0 auto; }

        header { text-align: center; margin-bottom: 40px; }
        h1 { margin: 0; color: #37474f; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; font-size: 1.8rem; }
        .sub { color: #546e7a; margin-top: 8px; font-weight: 600; font-size: 0.9rem; }
        .badge {
            display: inline-block; background: #00897b; color: #fff;
            padding: 4px 8px; border-radius: 4px; font-size: 0.7rem;
            text-transform: uppercase; margin-top: 5px; letter-spacing: 0.5px;
        }
        .badge.v2 { background: #d32f2f; }

        /* Debug toggle */
        .debug-toggle {
            margin: 20px 0;
            text-align: center;
        }
        .debug-toggle label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #546e7a;
            cursor: pointer;
        }
        .debug-toggle input {
            margin-right: 5px;
            cursor: pointer;
        }

        /* LEGEND */
        .legend { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 30px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .l-item { display: flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase; color: #555; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }

        /* CALENDAR */
        .month { background: white; border-radius: 8px; overflow: hidden; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e0e0e0; }
        .m-head { background: #37474f; color: white; padding: 15px; text-align: center; font-weight: 800; font-size: 1.2rem; letter-spacing: 1px; }

        .d-head { display: grid; grid-template-columns: repeat(7, 1fr); background: #eceff1; padding: 10px 0; border-bottom: 1px solid #cfd8dc; }
        .d-name { text-align: center; font-size: 0.75rem; font-weight: 800; color: #607d8b; }

        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #cfd8dc; }

        .day {
            background: white;
            min-height: 160px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* DAY STATES */
        .is-mother { background-color: white; }
        .is-mother .num { color: var(--my-accent); font-weight: 900; font-size: 1.2rem; }
        .is-mother::before { content: ""; display: block; position: absolute; top:0; left:0; right:0; height: 5px; background: var(--my-accent); }

        .is-father { background-color: #f5f5f5; }
        .is-father .num { color: #bdbdbd; }
        .is-father .action { opacity: 0.7; }

        /* ACTIONS */
        .action {
            margin-top: 5px;
            padding: 8px;
            border-radius: 4px;
            color: white;
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .a-pick { background-color: var(--act-pick); border-left: 4px solid #004d40; }
        .a-drop { background-color: var(--act-drop); border-left: 4px solid #263238; }
        .a-receive { background-color: var(--act-receive); border-left: 4px solid #33691e; }
        .a-tbd { background-color: var(--warning-bg); color: var(--warning-text); border-left: 4px solid #ef6c00; }

        .a-title { font-weight: 900; text-transform: uppercase; margin-bottom: 3px; font-size: 0.7rem; letter-spacing: 0.5px; }
        .a-time { font-weight: 700; font-size: 0.9rem; }
        .a-loc { font-style: italic; opacity: 0.9; font-size: 0.7rem; margin-top: 2px; }

        .note {
            margin-top: auto;
            text-align: right;
            font-size: 0.65rem;
            font-weight: 800;
            color: #d32f2f;
            padding-top: 6px;
            text-transform: uppercase;
        }

        /* DEBUG INFO */
        .debug-info {
            margin-top: 10px;
            padding: 6px;
            background: var(--debug-bg);
            color: var(--debug-text);
            font-size: 0.65rem;
            font-family: 'Courier New', monospace;
            border-radius: 3px;
            border-left: 3px solid var(--debug-text);
        }
        .debug-info div { margin: 2px 0; }

        @media print {
            body { background: white; padding: 0; }
            .month { break-inside: avoid; border: 1px solid #ccc; }
            .debug-toggle { display: none; }
            .debug-info { display: none !important; }
            .is-father { background-color: #eee !important; -webkit-print-color-adjust: exact; }
            .a-pick { background-color: #00897b !important; -webkit-print-color-adjust: exact; }
            .a-drop { background-color: #455a64 !important; -webkit-print-color-adjust: exact; }
            .a-tbd { background-color: #ffe0b2 !important; color: #e65100 !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Alexandra's Schedule</h1>
        <div class="badge v2">Rules Engine v2.0</div>
        <div class="badge">Anchored to Dec 12, 2025 (Mother's Weekend #1)</div>
        <div class="sub">Dec 2025 – Dec 2026 • Hierarchical Precedence System</div>
    </header>

    <div class="debug-toggle">
        <label>
            <input type="checkbox" id="debug-mode"> Show Debug Info (Rule Level & Match)
        </label>
    </div>

    <div class="legend">
        <div class="l-item"><div class="dot" style="background:var(--my-accent)"></div> With Mother</div>
        <div class="l-item"><div class="dot" style="background:#bdbdbd"></div> With Father</div>
        <div class="l-item"><div class="dot" style="background:var(--act-pick)"></div> Pick Up</div>
        <div class="l-item"><div class="dot" style="background:var(--act-receive)"></div> He Drops Off</div>
        <div class="l-item"><div class="dot" style="background:var(--act-drop)"></div> You Drop Off</div>
    </div>

    <div id="calendar-root"></div>
</div>

<script src="custody-engine.js"></script>
<script>
    // Calendar rendering using the new engine
    const root = document.getElementById('calendar-root');
    const debugCheckbox = document.getElementById('debug-mode');
    let debugMode = false;

    debugCheckbox.addEventListener('change', (e) => {
        debugMode = e.target.checked;
        renderCalendar();
    });

    const months = [
        { y: 2025, m: 11, name: 'December 2025' },
        { y: 2026, m: 0, name: 'January 2026' },
        { y: 2026, m: 1, name: 'February 2026' },
        { y: 2026, m: 2, name: 'March 2026' },
        { y: 2026, m: 3, name: 'April 2026' },
        { y: 2026, m: 4, name: 'May 2026' },
        { y: 2026, m: 5, name: 'June 2026' },
        { y: 2026, m: 6, name: 'July 2026' },
        { y: 2026, m: 7, name: 'August 2026' },
        { y: 2026, m: 8, name: 'September 2026' },
        { y: 2026, m: 9, name: 'October 2026' },
        { y: 2026, m: 10, name: 'November 2026' },
        { y: 2026, m: 11, name: 'December 2026' }
    ];

    const dNames = ['SUN','MON','TUE','WED','THU','FRI','SAT'];

    function renderCalendar() {
        root.innerHTML = '';

        months.forEach(cfg => {
            const mDiv = document.createElement('div');
            mDiv.className = 'month';
            mDiv.innerHTML = `<div class="m-head">${cfg.name}</div>`;

            const dh = document.createElement('div');
            dh.className = 'd-head';
            dNames.forEach(n => dh.innerHTML += `<div class="d-name">${n}</div>`);
            mDiv.appendChild(dh);

            const grid = document.createElement('div');
            grid.className = 'grid';

            const daysInMonth = new Date(cfg.y, cfg.m + 1, 0).getDate();
            const startDay = new Date(cfg.y, cfg.m, 1).getDay();

            // Empty cells before month starts
            for(let i=0; i<startDay; i++) {
                grid.innerHTML += `<div class="day is-father"></div>`;
            }

            // Days of month
            for(let d=1; d<=daysInMonth; d++) {
                const date = new Date(cfg.y, cfg.m, d);
                const result = window.CustodyEngine.evaluateCustody(date);

                let html = `<div class="num">${d}</div>`;

                // Events
                if (result.events && result.events.length > 0) {
                    result.events.forEach(e => {
                        let cls = 'a-pick';
                        if(e.type === 'drop') cls = 'a-drop';
                        if(e.type === 'receive') cls = 'a-receive';
                        if(e.type === 'tbd') cls = 'a-tbd';
                        html += `<div class="action ${cls}">
                            <span class="a-title">${e.title}</span>
                            <span class="a-time">${e.time}</span>
                            <span class="a-loc">@ ${e.location}</span>
                        </div>`;
                    });
                }

                // Note
                if(result.note) {
                    html += `<div class="note">${result.note}</div>`;
                }

                // Debug info
                if (debugMode) {
                    html += `<div class="debug-info">
                        <div><strong>Level ${result.matchedLevel}</strong></div>
                        <div>Rule: ${result.matchedRule}</div>
                        <div>Parent: ${result.parent}</div>
                    </div>`;
                }

                const cell = document.createElement('div');
                cell.className = `day is-${result.parent}`;
                cell.innerHTML = html;
                grid.appendChild(cell);
            }

            mDiv.appendChild(grid);
            root.appendChild(mDiv);
        });
    }

    // Initial render
    renderCalendar();
</script>
</body>
</html>
